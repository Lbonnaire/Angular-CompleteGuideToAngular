import{d as p,f as s,i as a,ja as d,l,o as g,qa as k,r as u}from"./chunk-PY2CLCYS.js";var i=class{constructor(r,I,t,e){this.email=r,this.id=I,this._token=t,this._tokenExpirationDate=e}get token(){return!this._tokenExpirationDate||new Date>this._tokenExpirationDate?null:this._token}};var h={production:!0,firebaseAPIKey:"AIzaSyCPEI3nHi0JIYvWFSO1nDpHK8tx0utsxJo"};var v=(()=>{let r=class r{constructor(t,e){this.http=t,this.router=e,this.user=new p(null)}signUp(t,e){return console.log("in signup"),this.http.post("https://identitytoolkit.googleapis.com/v1/accounts:signUp?key="+h.firebaseAPIKey,{email:t,password:e,returnSecureToken:!0}).pipe(a(this.handleError),l(o=>{this.handleAuth(o.email,o.localId,o.idToken,+o.expiresIn)}))}login(t,e){return this.http.post("https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key="+h.firebaseAPIKey,{email:t,password:e,returnSecureToken:!0}).pipe(a(this.handleError),l(o=>{this.handleAuth(o.email,o.localId,o.idToken,+o.expiresIn)}))}autoLogin(){let t=JSON.parse(localStorage.getItem("userData"));if(!t)return;let e=new i(t.email,t.id,t._token,new Date(t._tokenExpirationDate));if(e.token){this.user.next(e);let o=new Date(t._tokenExpirationDate).getTime()-new Date().getTime();this.autoLogout(o)}}logout(){this.user.next(null),this.router.navigate(["/auth"]),localStorage.removeItem("userData"),this.tokenExpirationTimer&&clearTimeout(this.tokenExpirationTimer),this.tokenExpirationTimer=null}autoLogout(t){setTimeout(()=>{this.logout()},t)}handleAuth(t,e,o,c){console.log("in handle auth");let f=new Date(new Date().getTime()+c*1e3),m=new i(t,e,o,f);this.user.next(m),this.autoLogout(c*1e3),localStorage.setItem("userData",JSON.stringify(m))}handleError(t){console.log("in handle error");let e="An unknown error occured!";if(!t.error||!t.error.error)return s(e);switch(console.log(t.error.error.message),t.error.error.message){case"EMAIL_EXISTS":e="This email exists already";break;case"EMAIL_NOT_FOUND":e="This email does not exist";break;case"INVALID_LOGIN_CREDENTIALS":e="This password is incorrect";break}return s(e)}};r.\u0275fac=function(e){return new(e||r)(u(d),u(k))},r.\u0275prov=g({token:r,factory:r.\u0275fac,providedIn:"root"});let n=r;return n})();export{v as a};
